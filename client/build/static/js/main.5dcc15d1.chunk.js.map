{"version":3,"sources":["utils/index.ts","form/Calendar.tsx","utils/trpc.ts","form/index.tsx","alarm-manager.ts","list/index.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["AlarmType","React","ref","control","displayMode","maxLength","error","help","name","onChange","required","showHeader","type","value","id","bulmaCalendarOptions","props","inputRef","calendarRef","current","BulmaCalendar","require","validateLabel","cancelLabel","clearLabel","todayLabel","nowLabel","minuteSteps","cal","on","target","startTime","startDate","removeListeners","defaultValue","client","createTRPCClient","url","transformer","superjson","trpc","createReactQueryHooks","queryClient","QueryClient","defaultOptions","queries","refetchOnWindowFocus","Duration","uid","window","URL","location","href","searchParams","get","Form","history","useHistory","locId","URLSearchParams","search","slice","console","log","allAlarms","useQuery","staleTime","useState","data","find","a","ahead","title","notify","alert","duration","disabled","alarm","setAlarm","editAlarm","useMutation","onSettled","invalidateQuery","addAlarm","onMutate","cancelQuery","setField","key","className","placeholder","e","repeat","once","Calendar","Date","d","setHours","getHours","setMinutes","getMinutes","now","getTime","showSecond","moment","hours","minutes","min","max","Number","defaultChecked","checked","onClick","mutate","save","goBack","push","AlarmManager","alarms","timers","Map","this","updateTimers","Notification","permission","requestPermission","body","toLocaleString","vibrate","requireInteraction","timer","clearTimeout","clearInterval","delete","done","clearTimers","setTimeout","timeout","recTimeout","set","List","sortAlarms","ids","alarmMap","map","setQueryData","filter","Boolean","saveSortList","newAlarms","deleteAlarm","alarmId","t","useEffect","style","flex","marginRight","u","nanoid","Promise","all","mutation","toString","aria-hidden","list","setList","dayjs","format","add","confirm","htmlFor","App","useLocation","TransitionGroup","path","Root","cx","QueryClientProvider","reportWebVitals","onPerfEntry","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.5dcc15d1.chunk.js","sourcesContent":["import type { inferHandlerInput } from '@trpc/server'\nimport type { AppRouter } from '../../../server'\nexport type AlarmCreateParam = inferHandlerInput<\n  AppRouter['_def']['mutations']['alarms.add']\n>[0]\nexport type AlarmEditParam = inferHandlerInput<\n  AppRouter['_def']['mutations']['alarms.edit']\n>[0]\nexport const emptyAlarm = (): AlarmCreateParam => ({\n  type: 'repeat',\n  ahead: 0,\n  title: '',\n  notify: true,\n  alert: false,\n  duration: 0,\n  disabled: false,\n})\n\nexport enum AlarmType {\n  once = 'once',\n  repeat = 'repeat',\n}\n\nexport const Duration = {\n  M1: 60 * 1000,\n  H1: 60 * 60 * 1000,\n}\n\nexport const IsServer = typeof window ==='undefined'\n\nconst u = IsServer ? new URL('https://localhost') : new URL(location.href)\nexport const uid = u.searchParams.get('id') || ''\n","import { Options as BulmaCalendarOptions } from 'bulma-calendar';\nimport 'bulma-calendar/dist/css/bulma-calendar.min.css'\nimport * as React from 'react';\n\ntype CalendarProps = Omit<React.ComponentPropsWithoutRef<'input'>, 'label' | 'onChange'> & {\n    control?: React.ReactElement;\n\n    displayMode?: BulmaCalendarOptions['displayMode'];\n\n    /**\n     * An error message to render.\n     */\n    error?: React.ReactNode;\n\n    /**\n     * A help message to render.\n     */\n    help?: React.ReactNode;\n\n    /**\n     * The name of the HTML element.\n     */\n    name?: string;\n\n    /**\n     * This is fired when the input value has changed.\n     *\n     * If the input type is `checkbox`, the value is a boolean. If the input type is `number`, the\n     * value is a number, otherwise it is a string.\n     */\n    onChange: (event: { target: HTMLInputElement }, value: Date) => void;\n\n    showHeader?: boolean;\n\n    /**\n     * The HTML input type.\n     *\n     * This may be extended if necessary.\n     */\n    type?: 'date' | 'time' | 'datetime'\n    bulmaCalendarOptions?: BulmaCalendarOptions\n  };\n\n/**\n * A Bulma styled form input element.\n */\nexport default React.forwardRef<HTMLInputElement, CalendarProps>(\n  (\n    {\n      control,\n      displayMode,\n      error,\n      help,\n      maxLength,\n      name,\n      onChange,\n      required,\n      showHeader = false,\n      type = 'datetime',\n      value,\n      id = name,\n      bulmaCalendarOptions,\n      ...props\n    },\n    ref,\n  ) => {\n    const inputRef = React.useRef<HTMLInputElement>();\n    const calendarRef = React.useRef<any>();\n\n    React.useImperativeHandle(ref, () => inputRef.current!);\n    React.useEffect(() => {\n      const BulmaCalendar = require('bulma-calendar')\n      calendarRef.current = new BulmaCalendar(inputRef.current!, {\n        showHeader,\n        type,\n        displayMode,\n        validateLabel: '确定',\n        cancelLabel: '取消',\n        clearLabel: '清除',\n        todayLabel: '今天',\n        nowLabel: '现在',\n        minuteSteps: 1,\n        ...bulmaCalendarOptions,\n      });\n    }, [displayMode, showHeader, type]);\n\n    React.useEffect(() => {\n      const cal = calendarRef.current!\n      cal.on('select', () => {\n        onChange({ target: inputRef.current! }, type === 'time' ? cal.startTime : cal.startDate);\n        // window['c_' + type] = calendarRef.current\n      });\n      return () => {\n        calendarRef.current!.removeListeners('select');\n      };\n    }, [onChange]);\n\n    return (\n        <input\n          {...props}\n          ref={inputRef as any}\n          defaultValue={value}\n          id={id}\n          maxLength={maxLength}\n          name={name}\n          required={required}\n        />\n    )\n  })\n","import { createReactQueryHooks, createTRPCClient } from '@trpc/react';\nimport type { inferProcedureOutput } from '@trpc/server';\n\nimport { QueryClient } from 'react-query';\nimport superjson from 'superjson';\n// ℹ️ Type-only import:\n// https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-8.html#type-only-imports-and-export\nimport type { AppRouter } from '../../../server';\n\n// create helper methods for queries, mutations, and subscriptionos\nexport const client = createTRPCClient<AppRouter>({\n  url: '/api/trpc',\n  transformer: superjson,\n});\n\n// create react query hooks for trpc\nexport const trpc = createReactQueryHooks({\n  client,\n  queryClient: new QueryClient({\n    defaultOptions: {\n      queries: {\n        refetchOnWindowFocus: false,\n      },\n    }\n  }),\n});\n\n/**\n * This is a helper method to infer the output of a query resolver\n * @example type HelloOutput = inferQueryOutput<'hello'>\n */\nexport type inferQueryOutput<\n  TRouteKey extends keyof AppRouter['_def']['queries']\n> = inferProcedureOutput<AppRouter['_def']['queries'][TRouteKey]>;\n","import React, { useState } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport dayjs from 'dayjs'\nimport Calendar from './Calendar'\nimport type { Alarm } from '../../../node_modules/.prisma/client'\nimport { trpc } from '../utils/trpc'\nimport { AlarmCreateParam, AlarmEditParam, AlarmType, Duration, emptyAlarm, uid } from '../utils'\nimport TimePicker from 'rc-time-picker'\nimport moment from 'moment'\n\nexport function Form() {\n  const history = useHistory<{id?: string}>()\n  ;(window as any)['h'] = history\n  const locSearch = new URLSearchParams(history.location.search.slice(1))\n  const locId = locSearch.get('id')\n  console.log('locId', locId, history.location.search)\n  const allAlarms = trpc.useQuery(['alarms.all'], {\n    staleTime: 3000,\n  })\n  const [alarm, setAlarm] = useState(\n    locId && allAlarms.data?.find(a => a.id === locId) || emptyAlarm()\n  )\n\n\n  const editAlarm = trpc.useMutation('alarms.edit', {\n    onSettled: () => {\n      trpc.invalidateQuery(['alarms.all']);\n    },\n  })\n\n  const addAlarm = trpc.useMutation('alarms.add', {\n    async onMutate(alarm) {\n      await trpc.cancelQuery(['alarms.all']);\n    },\n    onSettled: () => {\n      trpc.invalidateQuery(['alarms.all']);\n    },\n  })\n\n  const save = (alarm: AlarmCreateParam | AlarmEditParam) => {\n    if (('id' in alarm) && alarm.id) {\n      editAlarm.mutate(alarm)\n    } else {\n      alarm.uid = uid\n      addAlarm.mutate(alarm)\n    }\n  }\n  function setField(key: keyof Alarm, value: Alarm[keyof Alarm]) {\n    setAlarm({\n      ...alarm,\n      [key]: value,\n    })\n  }\n  return (\n    <div className=\"form\">\n      <div className=\"field is-grouped\">\n        <label className=\"label\">标题:</label>\n        <div className=\"control\">\n          <input\n            className=\"input\"\n            type=\"text\"\n            placeholder={alarm.title}\n            onChange={e => setField('title', e.target.value)}\n          />\n        </div>\n      </div>\n      <div className=\"field is-grouped\">\n        <label className=\"label\">类型:</label>\n        <div className=\"control\">\n          <div className=\"select\">\n            <select\n              defaultValue={alarm.type}\n              onChange={e => {\n                setField('type', e.target.value)\n              }}\n            >\n              <option value={AlarmType.repeat}>循环</option>\n              <option value={AlarmType.once}>定时</option>\n            </select>\n          </div>\n        </div>\n      </div>\n      {alarm.type === AlarmType.once && (\n        <div className=\"field is-grouped\">\n          <label className=\"label\">定时:</label>\n          <div className=\"control\">\n            <Calendar\n              className=\"input\"\n              type=\"time\"\n              value={new Date(alarm.duration + 16 * Duration.H1) as any}\n              onChange={(e, d) => {\n                let duration = new Date(0)\n                duration.setHours(d.getHours() + duration.getHours())\n                duration.setMinutes(d.getMinutes() + duration.getMinutes())\n                setField('timeout', Date.now() + duration.getTime())\n              }}\n            />\n          </div>\n        </div>\n      )}\n      {alarm.type === AlarmType.repeat && (\n      <div className=\"field is-grouped\" >\n        <label className=\"label\">循环:</label>\n        <div className=\"control\">\n          <TimePicker\n            showSecond={false}\n            defaultValue={moment(alarm.duration + 16 * Duration.H1)}\n            className=\"xxx\"\n            onChange={(d) => {\n              // let duration = new Date(0)\n              // duration.setHours(d.hours() + duration.getHours())\n              // duration.setMinutes(d.minutes() + duration.getMinutes())\n              setField('duration', d.hours() * Duration.H1 + d.minutes() * Duration.M1)\n            }}\n          />\n          {/* <Calendar\n            className=\"input\"\n            type=\"time\"\n            value={new Date(alarm.duration + 16 * Duration.H1) as any}\n            onChange={(e, d) => {\n              let duration = new Date(0)\n              duration.setHours(d.getHours() + duration.getHours())\n              duration.setMinutes(d.getMinutes() + duration.getMinutes())\n              setField('duration', duration.getTime())\n            }}\n          /> */}\n        </div>\n      </div>\n      )}\n      <div className=\"field is-grouped\">\n        <label className=\"label\">提前:</label>\n        <div className=\"control\">\n          <input type=\"number\" min={0} max={60 * 24} defaultValue={alarm.ahead} onChange={e => {\n            setField('ahead', Number(e.target.value) || 0)\n          }} />\n        </div>\n      </div>\n      <div className=\"field is-grouped\">\n        <label className=\"label\">通知:</label>\n        <div className=\"control\">\n          <input type=\"checkbox\" defaultChecked={alarm.notify} onChange={e => {\n            setField('notify', e.target.checked)\n          }} />\n        </div>\n      </div>\n      <div className=\"field is-grouped\">\n        <label className=\"label\">弹窗:</label>\n        <div className=\"control\">\n          <input type=\"checkbox\" defaultChecked={alarm.alert} onChange={e => {\n            setField('alert', e.target.checked)\n          }} />\n        </div>\n      </div>\n      <div className=\"field is-grouped\">\n        <div className=\"control\">\n          <button\n            onClick={e => {\n              save(alarm as AlarmCreateParam)\n              console.log('history', history)\n              history.goBack()\n            }}\n            className=\"button is-primary is-link\"\n          >\n            保存\n          </button>\n        </div>\n        <div className=\"control\">\n          <button\n            onClick={e => {\n              history.push('/')\n            }}\n            className=\"button is-link is-light\"\n          >\n            取消\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import type { Alarm } from '../../node_modules/.prisma/client'\n\nimport { AlarmEditParam, AlarmType, Duration } from \"./utils\"\n\nexport class AlarmManager {\n  timers: Map<string, { current: any }> = new Map()\n  constructor(public alarms: Alarm[], private save: (a: AlarmEditParam) => void) {\n    this.updateTimers()\n    ;(window as any)['alarmManager'] = this\n    if (Notification.permission !== 'granted') {\n      Notification.requestPermission()\n    }\n  }\n  notify(alarm: Alarm) {\n    const title = `${alarm.title} | 整点报时`\n    if (alarm.notify) {\n      new Notification(title, {\n        body: new Date().toLocaleString(),\n        vibrate: 1,\n        requireInteraction: true,\n      })\n    }\n    if (alarm.alert) {\n      alert(title)\n    }\n    console.log('notify', new Date().toLocaleString(), alarm)\n    // var audio = new Audio();\n    // audio.src= \"../sound/WindowsNotifyMessaging.wav\"\n    // audio.load()\n    // audio.play()\n  }\n  clearTimers(alarm: Alarm) {\n    let timer = this.timers.get(alarm.id) || { current: 0 }\n    if (timer.current) {\n      clearTimeout(timer.current)\n      clearInterval(timer.current)\n    }\n    this.timers.delete(alarm.id)\n  }\n  updateTimers() {\n    for (const alarm of this.alarms) {\n      if (alarm.disabled || alarm.done) {\n        this.clearTimers(alarm)\n        continue\n      }\n      let timer = this.timers.get(alarm.id)\n      if (!timer) {\n        timer = { current: 0 }\n        console.log('updateTimers', alarm)\n        const now = Date.now()\n        if (alarm.type === AlarmType.once) {\n          timer.current = setTimeout(() => {\n            this.notify(alarm)\n            this.save({\n              ...alarm,\n              done: true\n            } as AlarmEditParam)\n          }, alarm.timeout - (now + alarm.ahead * Duration.M1))\n        } else if (alarm.type === AlarmType.repeat) {\n          const recTimeout = () => {\n            const timeout = alarm.duration - (Date.now() + alarm.ahead * Duration.M1) % alarm.duration\n            timer!.current = setTimeout(() => {\n              this.notify(alarm)\n              recTimeout()\n            }, timeout)\n\n            console.log(`next repeat ${alarm.title}`, new Date(Date.now() + timeout).toLocaleString(), alarm)\n          }\n          recTimeout()\n        }\n        this.timers.set(alarm.id, timer)\n      }\n    }\n  }\n}\n","import React, { useEffect } from 'react'\nimport dayjs from 'dayjs'\n\nimport { ReactSortable } from 'react-sortablejs'\nimport { trpc } from '../utils/trpc'\nimport type { Alarm } from '../../../node_modules/.prisma/client'\nimport { useHistory } from 'react-router-dom'\nimport { nanoid } from 'nanoid'\nimport { AlarmCreateParam, AlarmEditParam, uid } from '../utils'\nimport { AlarmManager } from '../alarm-manager'\n\nexport function List() {\n  let history = useHistory()\n  const allAlarms = trpc.useQuery(['alarms.all', uid], {\n    staleTime: 3000,\n  })\n  const sortAlarms = trpc.useMutation('alarms.sortAll', {\n    async onMutate(ids) {\n      await trpc.cancelQuery(['alarms.all'])\n      let alarmMap = new Map(allAlarms.data?.map((a) => [a.id, a]))\n      trpc.setQueryData(\n        ['alarms.all'],\n        ids.map((id) => alarmMap.get(id)!).filter(Boolean)\n      )\n    },\n    onSettled: () => {\n      trpc.invalidateQuery(['alarms.all'])\n    },\n  })\n  const saveSortList = async (newAlarms: Alarm[]) => {\n    sortAlarms.mutate(newAlarms.map((a) => a.id))\n  }\n  const deleteAlarm = trpc.useMutation('alarms.delete', {\n    async onMutate(alarmId) {\n      await trpc.cancelQuery(['alarms.all'])\n      trpc.setQueryData(\n        ['alarms.all'],\n        allAlarms.data!.filter((t) => t.id !== alarmId)\n      )\n    },\n    onSettled: () => {\n      trpc.invalidateQuery(['alarms.all'])\n    },\n  })\n  const editAlarm = trpc.useMutation('alarms.edit', {\n    async onMutate(alarm) {\n      await trpc.cancelQuery(['alarms.all'])\n      trpc.setQueryData(\n        ['alarms.all'],\n        allAlarms.data!.map((a) => (a.id === alarm.id ? { ...a, ...alarm } : a))\n      )\n    },\n    onSettled: () => {\n      trpc.invalidateQuery(['alarms.all'])\n    },\n  })\n  useEffect(() => {\n    if (allAlarms.data) {\n      new AlarmManager(allAlarms.data, (a: AlarmEditParam) => {\n        editAlarm.mutate(a)\n      })\n    }\n  }, [allAlarms.data])\n  return (\n    <nav className=\"panel\">\n      <p className=\"panel-heading\">\n        <span style={{ flex: 1 }}>整点报时</span>\n        <button\n          className=\"button is-link is-small\"\n          style={{ marginRight: 10 }}\n          title=\"使用永久链接\"\n          onClick={async (e) => {\n            let u = new URL(location.href)\n            const uid = nanoid()\n            await Promise.all(allAlarms.data?.map(a => {\n              return trpc.client.mutation('alarms.add', {\n                ...a,\n                uid\n              } as AlarmCreateParam)\n            }) || [])\n            u.searchParams.set('id', uid)\n            location.href = u.toString()\n          }}\n        >\n          <i className=\"fas fa-external-link-alt\" aria-hidden=\"true\"></i>\n        </button>\n        <button\n          className=\"button is-primary is-small\"\n          title=\"添加新的提醒\"\n          onClick={(e) => {\n            history.push(`/form`)\n          }}\n        >\n          <i className=\"fas fa-plus\" aria-hidden=\"true\"></i>\n        </button>\n      </p>\n      <ReactSortable list={allAlarms.data || []} setList={saveSortList}>\n        {allAlarms.data?.map((a) => {\n          return (\n            <a key={a.id} className=\"panel-block\">\n              <span className=\"panel-icon\">\n                <i\n                  className={`fas fa-${\n                    a.type === 'once' ? 'hourglass-half' : 'sync'\n                  }`}\n                  aria-hidden=\"true\"\n                ></i>\n              </span>\n              <span className=\"ca-title\">\n                {a.title}\n                <div className=\"ca-subtitle\">\n                  {a.type === 'once'\n                    ? dayjs(Number(a.timeout)).format('YYYY/MM/DD HH:mm')\n                    : dayjs(Number(a.duration)).add(-8, 'h').format('HH:mm')}\n                </div>\n              </span>\n              <i\n                className={`fas fa-times remove-btn`}\n                aria-hidden=\"true\"\n                onClick={(e) => {\n                  let b = confirm(`确定要删除「${a.title}」吗?`)\n                  if (b) {\n                    deleteAlarm.mutate(a.id)\n                  }\n                }}\n              ></i>\n              <i\n                className={`fas fa-cog config-btn`}\n                aria-hidden=\"true\"\n                onClick={(e) => {\n                  history.push(`/form?id=${a.id}`)\n                }}\n              ></i>\n              <div className=\"field\">\n                <input\n                  id={a.id}\n                  type=\"checkbox\"\n                  className=\"switch\"\n                  defaultChecked={!a.disabled}\n                  onChange={(e) => {\n                    // save({ ...a, disabled: !e.target.checked })\n                    editAlarm.mutate({\n                      ...a,\n                      disabled: !e.target.checked,\n                    } as any)\n                  }}\n                />\n                <label htmlFor={a.id}></label>\n              </div>\n            </a>\n          )\n        })}\n      </ReactSortable>\n    </nav>\n  )\n}\n","\nimport 'bulma/css/bulma.min.css'\nimport 'bulma-switch/dist/css/bulma-switch.min.css'\nimport './App.scss'\nimport React from 'react'\nimport { render } from 'react-dom'\nimport cx from 'clsx'\nimport { Switch, Route, HashRouter as Router, useLocation } from 'react-router-dom'\nimport { Form } from './form'\nimport { List } from './list'\nimport { TransitionGroup, CSSTransition } from 'react-transition-group'\nimport { QueryClientProvider } from 'react-query'\nimport { trpc } from './utils/trpc'\n// import { history } from '../comps/utils'\n\nfunction App() {\n  let location = useLocation()\n  return (\n    <TransitionGroup>\n      <Switch>\n        <Route path=\"/form\">\n          <Form />\n        </Route>\n        <Route path=\"/\">\n          <List />\n        </Route>\n      </Switch>\n    </TransitionGroup>\n  )\n}\n\nexport default function Root() {\n  return (\n    <div className={cx('root', 'container')}>\n      <QueryClientProvider client={trpc.queryClient}>\n        <Router>\n          <App />\n        </Router>\n      </QueryClientProvider>\n    </div>\n  )\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function && process.env.NODE_ENV === 'development') {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals(console.log);\n"],"sourceRoot":""}